"use strict";(self.webpackChunkklerk_website=self.webpackChunkklerk_website||[]).push([[31],{3189:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>d});var o=t(4848),r=t(8453);const a={sidebar_position:1},s="Web Tools",i={id:"plugins/html",title:"Web Tools",description:"Web Tools is a plugin that helps you build a multi-page application (MPA) using Ktor.",source:"@site/docs/plugins/html.md",sourceDirName:"plugins",slug:"/plugins/html",permalink:"/klerk/docs/plugins/html",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Plugins",permalink:"/klerk/docs/category/plugins"},next:{title:"GraphQL",permalink:"/klerk/docs/plugins/graphql"}},l={},d=[{value:"Admin UI",id:"admin-ui",level:2},{value:"Forms",id:"forms",level:2},{value:"Simple",id:"simple",level:3},{value:"Advanced",id:"advanced",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"web-tools",children:"Web Tools"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.em,{children:"Web Tools"})," is a plugin that helps you build a multi-page application (MPA) using ",(0,o.jsx)(n.a,{href:"https://ktor.io/",children:"Ktor"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"admin-ui",children:"Admin UI"}),"\n",(0,o.jsx)(n.p,{children:"The plugin can generate an admin UI which allows you to browse the data, issue commands,\nview documentation (state diagrams, event parameters etc.), audit logs and more. Even if you will eventually\nbuild your own admin UI, this auto generated UI can be helpful in the beginning of your project."}),"\n",(0,o.jsx)(n.p,{children:"To generate the admin UI, first create a configuration:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'private val autoAdminUIConfig = LowCodeMain(\n    clerk, LowCodeConfig(\n        basePath = "/admin",\n        contextProvider = ::contextFromCall,\n        showOptionalParameters = ::showOptionalParameters,\n        cssPath = "https://unpkg.com/almond.css@latest/dist/almond.min.css",\n        knownAlgorithms = emptySet(),\n    )\n)\n'})}),"\n",(0,o.jsx)(n.p,{children:"Add the routes:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"routing {\n    apply(autoAdminUIConfig.registerRoutes())\n    ...\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"forms",children:"Forms"}),"\n",(0,o.jsxs)(n.p,{children:["The plugin can generate HTML forms for your event parameters. It takes care of\ncross-site request forgery (CSRF) protection and ",(0,o.jsx)(n.a,{href:"/docs/usage/commands#idempotence",children:"idempotence"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"The forms can be generated in two ways: simple and advanced."}),"\n",(0,o.jsx)(n.h3,{id:"simple",children:"Simple"}),"\n",(0,o.jsx)(n.p,{children:"The easiest way to generate forms in your application is to ask Clerk to generate\na button for each available event:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'val buttonTargets = ButtonTargets(back = "/", model = "/game/{id}", "/")\nclerk.readSuspend(context) {\n    call.respondHtml {\n        body {\n            getPossibleVoidEvents(Game::class).forEach {\n                apply(LowCodeCreateEvent.renderButton(it, clerk, null, createLCConfig(), buttonTargets, context))\n            }\n        }\n    }\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["When the button is clicked, a form is rendered on a new page. The ",(0,o.jsx)(n.code,{children:"ButtonTargets"})," determines the subsequent URL when the\nsubmitted form is cancelled, succeeded or failed."]}),"\n",(0,o.jsx)(n.h3,{id:"advanced",children:"Advanced"}),"\n",(0,o.jsx)(n.p,{children:"The advanced mode gives you more control of how the form is rendered. The form is built in tree steps:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Create a form template at startup."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'val createTodoFormTemplate = EventFormTemplate(EventWithParameters(\n    event = TodoEvents.CreateTodo.toEvent(),\n    parameters = EventParameters(CreateTodoParams::class),\n), clerk,"/todos") {\n    text(CreateTodoParams::title)\n    text(CreateTodoParams::body)\n    selectReference(CreateTodoParams::owner)\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["It is recommended to call ",(0,o.jsx)(n.code,{children:"validate()"})," on the template on startup to avoid unpleasant surprises in production."]}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsx)(n.li,{children:"Use the template to generate a form object."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'val createTodoFormDefaultValues = CreateTodoParams(\n            title = Title("your default value here"),\n            body = Body(""),\n            owner = context.user.id\n        )\nval createTodoForm = createTodoFormTemplate.build(\n            call,       // the Ktor ApplicationCall\n            createTodoFormDefaultValues,\n            reader = this,\n            referenceSelects = mapOf(CreateTodoParams::owner to data.users.all)\n        )\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsx)(n.li,{children:"Render the form object."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"call.respondHtml {\n    body {\n        createTodoForm.render(this)\n    }\n}\n"})})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>i});var o=t(6540);const r={},a=o.createContext(r);function s(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);