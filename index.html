<!doctype html>
<html lang="en" dir="ltr" class="mdx-wrapper mdx-page plugin-pages plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Klerk Framework | Klerk</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://prettybyte.com/website/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://prettybyte.com/website/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://prettybyte.com/website/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Klerk Framework | Klerk"><meta data-rh="true" name="description" content="Klerk is a Kotlin framework for managing data on the backend. It combines the database"><meta data-rh="true" property="og:description" content="Klerk is a Kotlin framework for managing data on the backend. It combines the database"><link data-rh="true" rel="icon" href="/website/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://prettybyte.com/website/"><link data-rh="true" rel="alternate" href="https://prettybyte.com/website/" hreflang="en"><link data-rh="true" rel="alternate" href="https://prettybyte.com/website/" hreflang="x-default"><script data-rh="true">function insertBanner(){var n=document.createElement("div");n.id="__docusaurus-base-url-issue-banner-container";n.innerHTML='\n<div id="__docusaurus-base-url-issue-banner" style="border: thick solid red; background-color: rgb(255, 230, 179); margin: 20px; padding: 20px; font-size: 20px;">\n   <p style="font-weight: bold; font-size: 30px;">Your Docusaurus site did not load properly.</p>\n   <p>A very common reason is a wrong site <a href="https://docusaurus.io/docs/docusaurus.config.js/#baseUrl" style="font-weight: bold;">baseUrl configuration</a>.</p>\n   <p>Current configured baseUrl = <span style="font-weight: bold; color: red;">/website/</span> </p>\n   <p>We suggest trying baseUrl = <span id="__docusaurus-base-url-issue-banner-suggestion-container" style="font-weight: bold; color: green;"></span></p>\n</div>\n',document.body.prepend(n);var e=document.getElementById("__docusaurus-base-url-issue-banner-suggestion-container"),s=window.location.pathname,o="/"===s.substr(-1)?s:s+"/";e.innerHTML=o}document.addEventListener("DOMContentLoaded",(function(){void 0===window.docusaurus&&insertBanner()}))</script><link rel="alternate" type="application/rss+xml" href="/website/blog/rss.xml" title="Klerk RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/website/blog/atom.xml" title="Klerk Atom Feed"><link rel="stylesheet" href="/website/assets/css/styles.9ef707c4.css">
<script src="/website/assets/js/runtime~main.45d0c618.js" defer="defer"></script>
<script src="/website/assets/js/main.30c6a8fb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/website/"><b class="navbar__title text--truncate">Klerk</b></a><a class="navbar__item navbar__link" href="/website/docs/intro">Documentation</a><a href="/website/apidoc/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Reference</a><a class="navbar__item navbar__link" href="/website/plugins">Plugins</a><a class="navbar__item navbar__link" href="/website/commercial-licence">Commercial licence</a></div><div class="navbar__items navbar__items--right"><a href="https://gitlab.com/linustornkrantz/dataframework" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><main class="container container--fluid margin-vert--lg"><div class="row mdxPageWrapper_j9I6"><div class="col col--8"><article><h1>Klerk Framework</h1>
<p>Klerk is a Kotlin framework for managing data on the backend. It combines the database
and business-logic layer in a traditional system and lets you build your application on top of it. Klerk helps you build a system that is secure,
easy to understand, avoids complexity, has fewer bugs and low latency.</p>
<p>Klerk is open source under AGPL (<a href="/website/commercial-licence">commercial licenses</a> are available).</p>
<p>Klerk means &#x27;bookkeeper&#x27; in swedish.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Klerk is still in beta. The API is not yet stable.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="basic-ideas">Basic ideas<a class="hash-link" aria-label="Direct link to Basic ideas" title="Direct link to Basic ideas" href="/website/#basic-ideas">​</a></h2>
<p>The purpose of Klerk is to enable development of high quality information systems. To achieve this, Klerk is designed
with these ideas in mind:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="secure">Secure<a class="hash-link" aria-label="Direct link to Secure" title="Direct link to Secure" href="/website/#secure">​</a></h3>
<p><em>Secure by design:</em>
All interaction with the data goes through Klerk. This means that Klerk can guarantee that all authorization rules are
enforced. It is simply not possible for a developer to forget to check a security rule. While it is possible for a developer
to bypass a rule, these exceptions requires the developer to explicitly state that the rule should not be enforced, making
this code stand out.</p>
<p><em>Secure by default:</em>
All data interaction is denied unless explicitly allowed. To be more precise: in order for a data access to be allowed,
there must exist at least one authorization rule that allows the action, and
there must not exist any rule that denies the action.</p>
<p><em>Audit trail:</em>
As all information is passed through Klerk, it provides a meaningful audit trail out of the box. Not only does it record
data modification, it can also record data access.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="easy-to-understand">Easy to understand<a class="hash-link" aria-label="Direct link to Easy to understand" title="Direct link to Easy to understand" href="/website/#easy-to-understand">​</a></h3>
<p>Development in Klerk is split into a higher (design) level and a lower (details) level. On the higher level you design the system by
telling the framework about your pieces. On the lower level you describe each piece in detail. This separation allows
you to design the system without loosing yourself in the details, and it becomes easier for other developers to grasp
how the system works. It also allows Klerk to generate state diagrams and other documentation, these can be generated
even before the lower level is implemented.</p>
<p>It is possible (and encouraged) to start with the higher level and use the generated documentation to get the design
approved by all stakeholders before writing any code on the lower level.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="avoids-complexity">Avoids complexity<a class="hash-link" aria-label="Direct link to Avoids complexity" title="Direct link to Avoids complexity" href="/website/#avoids-complexity">​</a></h3>
<p>Klerk reduces the system&#x27;s complexity in two ways: it takes care of the complex stuff that can&#x27;t be avoided,
and it forces you to write simple code. As you mostly write pure functions and simple data structures, you rarely feel the
need to write &#x27;clever&#x27; code like layers of abstractions, multiple
inheritance, classes with lots of dependencies and other stuff that complicates the system.</p>
<p>The system you build can be extensive without being complex. Since the system is composed of simple pieces, the resulting system is
generally not entangled even if it is large. It is possible to look at one part and understand exactly what
that part means without knowing about the whole system. Likewise, it is possible to modify one part without affecting
other parts of the system.</p>
<p>One of the most important source of complexity is state, and unfortunately, information systems must handle state. Klerk
makes it easy to tame this complexity using <a href="https://en.wikipedia.org/wiki/Finite-state_machine" target="_blank" rel="noopener noreferrer">state machines</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fewer-bugs">Fewer bugs<a class="hash-link" aria-label="Direct link to Fewer bugs" title="Direct link to Fewer bugs" href="/website/#fewer-bugs">​</a></h3>
<p><em>Consistency</em>: At startup, Klerk analyses the higher level design and can detect if there is an inconsistency. Similarly,
the data is verified to be consistent with the design. This makes you aware of bugs early.</p>
<p><em>Explicit</em>: Klerk requires you to explicitly state validation rules, leaving less room for mistakes.</p>
<p><em>Keep the knowledge in one place:</em> In most traditional systems, both the backend and the user interface must know about
the rules. Instead of implementing them twice, the UI can acquire this knowledge by asking Klerk, allowing you to easily
keep the frontend in sync with the backend. Start with
telling Klerk to generate a button or form for each possible action given the current state. If you don&#x27;t like the
button/form, you can render it yourself after asking Klerk if the action is possible given the current state.</p>
<p><em>Easy to test:</em> Since Klerk forces you to write simple pieces of code, they are easy to test with unit tests.</p>
<p><em>Don&#x27;t write infrastructure code:</em> Since Klerk takes care of most of the infrastructure in the system, you don&#x27;t have
to think about hard stuff like cache invalidation and race conditions.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="low-latency">Low latency<a class="hash-link" aria-label="Direct link to Low latency" title="Direct link to Low latency" href="/website/#low-latency">​</a></h3>
<p>End users are annoyed when a system is not responding quickly to user actions. In e-commerce, latency may even have an impact
on revenue. Klerk responds very quickly to requests, enabling developers to build software to be proud of.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-can-you-build-with-klerk">What can you build with Klerk?<a class="hash-link" aria-label="Direct link to What can you build with Klerk?" title="Direct link to What can you build with Klerk?" href="/website/#what-can-you-build-with-klerk">​</a></h2>
<p>You are free to use other backend components to build
whatever you want on top of Klerk, such as</p>
<ul>
<li>an API (JSON, REST, GraphQL) serving your frontend</li>
<li>a web application using server generated HTML</li>
<li>a microservice communicating via RPC or message queues</li>
</ul>
<p>Klerk shines when mutations can be described as domain events (e.g. &quot;the invoice has been approved&quot;) and
when many of your business rules depends on state (e.g. &quot;the invoice must be approved before it can be paid&quot;).</p>
<p>However, Klerk is not always the right choice.
If you are building a trivial application, Klerk probably doesn&#x27;t add enough value to motivate learning the framework.
Furthermore, Klerk has some limitations:</p>
<ul>
<li>
<p>Klerk must currently be run on a single machine. This means that it is not possible to have software redundancy to protect against
hardware failures. It also means that Klerk is not horizontal scalable, which limits the system to a few thousand read requests per
second on a fairly low-end server. There are plans to
make Klerk run on multiple instances which will ensure high-availability and scaling.</p>
</li>
<li>
<p>The framework is designed in such way that it never will be able to process many thousands of commands
per second, but it should be able to sustain more than 100 commands per second.</p>
</li>
<li>
<p>Klerk processes all data at startup, among other things to make sure the configuration (your code) is compatible with all
data. As a consequence, the upstart time may be noticeable if you have many millions of entities in the system.</p>
</li>
</ul>
<p>Taken together, if you are expecting millions of concurrent users, Klerk is probably not a good fit unless you
can partition the data (e.g. single-tenant systems).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="core-concepts">Core concepts<a class="hash-link" aria-label="Direct link to Core concepts" title="Direct link to Core concepts" href="/website/#core-concepts">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="declarative">Declarative<a class="hash-link" aria-label="Direct link to Declarative" title="Direct link to Declarative" href="/website/#declarative">​</a></h3>
<p>A traditional system is built so that it (hopefully) behaves according to the specification. With Klerk it is the other way
around: you give the specification to Klerk in a semi-declarative format and Klerk will uphold the data integrity and make
sure these rules are not broken. You carefully declare your data and
the rules that your data must obey:</p>
<ul>
<li>Types</li>
<li>Validation</li>
<li>Which events are allowed when the data has a certain state</li>
<li>How do the events change the data</li>
<li>Who is allowed to trigger the events</li>
<li>Who is allowed to read certain data</li>
<li>... and more</li>
</ul>
<p>You declare all this using code. As you may know, Kotlin lends itself to making this kind of domain-specific
language (DSL). The DSL is used to describe the system on the higher level. When it comes to the details, normal Kotlin
code is used.</p>
<p>Since Klerk understands the specification, you can query the framework not only for the data but also for the rules.
The ability to query the rules can be
very useful when building a UI. Should the &quot;Send invite&quot; button be visible now? Let&#x27;s ask the framework. Which fields
should the form contain? Klerk knows. What are the validation rules of the email field? Ask the framework. Or
just submit the fields as a dry-run command and Klerk will tell you what would happen if the command would be submitted
for real.</p>
<p>As mentioned, you only need to implement the business logic once, making it easy to keep the UI and rules in
sync. It is even possible to build an auto-generated UI that is updated as soon as you change the business logic. In
fact, Klerk comes with a built-in auto-generated admin UI.</p>
<p>Other tools also take advantage of this queryable configuration. There is an auto-generated GraphQL API. Klerk also
ships with a form builder that generates HTML forms based on your data and rules.</p>
<p>Being able to query the rules also creates new possibilities when it comes to system documentation. It is possible
generate state diagrams which enables non-programmers to grasp how the system actually behaves. Having an up-to-date,
accessible and understandable documentation is useful for many stakeholders (e.g. product owners, customers, testers,
onboarding developers, support, sales).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="event-driven">Event driven<a class="hash-link" aria-label="Direct link to Event driven" title="Direct link to Event driven" href="/website/#event-driven">​</a></h3>
<p>Data is modified by sending commands to the framework which may result in one or more domain events. If you want to update the <em>favoriteBook</em> property on a
<em>User</em> model, you will not execute an SQL update command like with most databases. Instead, you will configure the
system
so that it accepts an event called <code>SetFavouriteBook</code> which takes some parameter. Then you declare on which type of
model and state
the event should be available and some other stuff like validation and authorization. You also write a function which
says how the model should be changed by the event (in this case just replace the <em>favoriteBook</em> with the event
parameter). You may now issue the command <code>SetFavouriteBook</code> along with its parameters.</p>
<p>As mentioned, Klerk lets you use state machines to manage states safely. Each model will have its own state machine, in which
you declare the model&#x27;s states. You then tell the framework
which events a certain state will accept, if there are any preconditions, and what should happen when the event is
triggered.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="learn-more">Learn more<a class="hash-link" aria-label="Direct link to Learn more" title="Direct link to Learn more" href="/website/#learn-more">​</a></h2>
<p>Check out the example projects and read the <a href="/website/docs/intro">documentation</a> to get started.</p></article></div><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/website/#basic-ideas">Basic ideas</a><ul><li><a class="table-of-contents__link toc-highlight" href="/website/#secure">Secure</a></li><li><a class="table-of-contents__link toc-highlight" href="/website/#easy-to-understand">Easy to understand</a></li><li><a class="table-of-contents__link toc-highlight" href="/website/#avoids-complexity">Avoids complexity</a></li><li><a class="table-of-contents__link toc-highlight" href="/website/#fewer-bugs">Fewer bugs</a></li><li><a class="table-of-contents__link toc-highlight" href="/website/#low-latency">Low latency</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/website/#what-can-you-build-with-klerk">What can you build with Klerk?</a></li><li><a class="table-of-contents__link toc-highlight" href="/website/#core-concepts">Core concepts</a><ul><li><a class="table-of-contents__link toc-highlight" href="/website/#declarative">Declarative</a></li><li><a class="table-of-contents__link toc-highlight" href="/website/#event-driven">Event driven</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/website/#learn-more">Learn more</a></li></ul></div></div></div></main></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 PrettyByte AB.</div></div></div></footer></div>
</body>
</html>